---
name: "Game Config Text Checker"
description: "AI-powered game configuration text review tool for typo detection, grammar checking, sensitive word filtering, and content compliance"
tags: [game, text-review, config-check, AI, ollama, qwen]
version: "2.3"
author: "AI Assistant"
created: "2025-12-17"
updated: "2025-12-19"
---

# 🎮 Game Config Text Checker SKILL

## 📋 技能概述

这是一个专业的游戏配置文本审核技能，专门用于检查游戏配置文件（Excel）中的剧情对白、任务文本等内容。基于 AI 大模型（Ollama）进行智能检查，能够发现错别字、语病、敏感词、内容合规等问题。

### 核心能力

| 功能 | 描述 |
|------|------|
| ✍️ **错别字检测** | 重点检查"的地得"用法、常见错别字 |
| 📝 **语病识别** | 主语混乱、搭配不当、词性误用等 |
| 🚫 **敏感词过滤** | 竞品相关词汇、政治敏感内容 |
| ✅ **内容合规** | 黄赌毒、暴力色情等不当内容 |
| 📊 **批量处理** | 支持大规模数据批量检查 |
| 📈 **详细报告** | 生成 Excel 格式的检查报告 |

### 技术特性

- 🤖 **AI 驱动**: 使用 Ollama 本地 AI 模型（默认 qwen3:14b-q4_K_M）
- ⚡ **GPU 加速**: 强制使用 GPU，检查速度提升 10-50 倍
- 🎯 **结果稳定**: 低温度配置确保相同输入产生相同输出
- 🏥 **自动启动**: 自动检测模型状态，未运行时自动启动
- � **智能批处理**: 自动分批处理，避免模型幻觉
- 🎯 **智能匹配**: 智能列名匹配（精确+模糊），支持多行表头
- 🛡️ **容错处理**: 完善的 JSON 解析和错误处理

---

## 🚀 使用方法


### 方式1：通过 AI 助手(配合知识库使用效果更佳)

```
使用 SKILL 检查 F:\XXX\XX.xlsx 的 XXX sheet，检查 XXX 列
```

### 方式2：修改脚本配置

编辑 `conf_check.py` 中的配置区域后直接运行：

```python
# 配置区域
INPUT_FILE = "你的配置文件.xlsx"
SHEET_NAME = "Sheet名称"
TARGET_COLUMN = "列名"
```

---

## 📖 工作流程

```
┌─────────────────┐
│   环境检查阶段   │
├─────────────────┤
│ ✅ 验证 Ollama 连接
│ ✅ 验证模型存在
│ 🏥 检查模型健康度
│ 🚀 自动启动模型
│ ✅ 验证文件路径
│ ✅ 验证 Sheet/列名
└────────┬────────┘
         ▼
┌─────────────────┐
│   数据加载阶段   │
├─────────────────┤
│ 📊 读取 Excel
│ 🔍 智能匹配列名
│ 🧹 过滤有效文本
│ 📝 记录原始行号
└────────┬────────┘
         ▼
┌─────────────────┐
│  AI 批量检查    │
├─────────────────┤
│ 📦 分批处理数据
│ 🤖 调用 AI 检查
│ 📋 解析 JSON 结果
│ 🔄 容错处理
│ 📊 显示进度条
└────────┬────────┘
         ▼
┌─────────────────┐
│   报告生成阶段   │
├─────────────────┤
│ 📝 汇总问题
│ 📄 生成 Excel
│ ✨ 添加配置原文
│ 🆔 添加对白 ID
│ 💾 安全保存
└─────────────────┘
```

---

## 🎯 检查规范

### 必查项

| 类型 | 说明 | 示例 |
|------|------|------|
| **错别字** | 重点：的地得用法 | 悉悉索索→窸窸窣窣 |
| **语病** | 主语混乱、搭配不当 | 主语缺失、词性误用 |
| **成语错用** | 褒贬义混淆 | 负隅顽抗、娓娓道来 |
| **多字/漏字** | 文字遗漏或多余 | - |
| **内容合规** | 政治敏感、暴力色情、黄赌毒 | - |

### 忽略项

- 重复内容
- 非中文文本
- 标点符号、数字
- 游戏内角色名字

---

## 📊 检查报告格式

生成的 Excel 报告包含以下列：

| 列名 | 说明 | 示例 |
|------|------|------|
| 行号 | Excel 原始行号 | 260 |
| 配置原文 | 原始文本内容 | "你好，欢迎来到游戏世界！" |
| 对白id | 第一列的 ID 值 | "123" |
| 问题说明 | 问题类型和具体描述 | "错别字：'的'应改为'地'" |
| 修改建议 | 具体的修改建议 | "将'的'改为'地'" |

---

## ⚙️ 配置说明

### 模型配置

```python
# Ollama 服务地址
OLLAMA_URL = "http://localhost:11434/api/generate"

# 模型名称
MODEL_NAME = "qwen3:14b-q4_K_M"
```

### GPU 和稳定性配置

```python
payload = {
    "model": MODEL_NAME,
    "prompt": prompt,
    "stream": False,
    "options": {
        "temperature": 0.1,      # 低温度保证结果确定性
        "num_ctx": 8192,         # 上下文窗口
        "num_gpu": 99,           # 使用所有可用 GPU
        "num_predict": 4096,     # 最大生成长度
        "stop": ["\n\n\n", "【待检查数据】", "现在开始检查"]
    }
}
```

### 配置参数说明

| 参数 | 默认值 | 说明 |
|------|--------|------|
| `temperature` | 0.1 | 极低温度确保结果一致性 |
| `num_ctx` | 8192 | 大上下文窗口支持长文本 |
| `num_gpu` | 99 | 强制使用所有 GPU |
| `num_predict` | 4096 | 避免长文本检查被截断 |
| `BATCH_SIZE` | 30 | 每批处理行数 |

### 模型推荐

| 模型 | 显存 | 速度 | 质量 | 场景 |
|------|------|------|------|------|
| `qwen3:7b` | 4GB | ⚡⚡⚡ | ⭐⭐ | 快速检查 |
| `qwen3:14b-q4_K_M` | 8GB | ⚡⚡ | ⭐⭐⭐ | **推荐** |
| `qwen3:32b` | 16GB | ⚡ | ⭐⭐⭐⭐ | 精细检查 |

---

## 🏥 模型健康度检查

### 自动检测与启动

SKILL 会在执行检查前自动进行模型健康度检查：

```
🏥 正在检查模型健康度: qwen3:14b-q4_K_M
🔍 测试模型响应...
⚠️ 模型未加载，正在启动模型...
🚀 正在启动模型: qwen3:14b-q4_K_M
📝 执行命令: ollama run qwen3:14b-q4_K_M
⏳ 等待模型加载（约15-30秒）...
✅ 模型启动成功: qwen3:14b-q4_K_M
```

### 错误处理

| 错误 | 原因 | 解决方案 |
|------|------|----------|
| ❌ 找不到 ollama 命令 | Ollama 未安装 | 安装 Ollama |
| ❌ 模型不存在 | 未下载模型 | `ollama pull` 下载 |
| ❌ 服务不可用 | Ollama 未运行 | `ollama serve` 启动 |

---

## 🔧 高级功能

### 1. 多列匹配

```bash
# 当存在多个同名列时，指定使用第几个
python conf_check.py "file.xlsx" "Sheet1" "text" --column-index 0
```

### 2. 自定义批次大小

```bash
# 显存充足：增大批次
python conf_check.py "file.xlsx" "Sheet1" "text" --batch-size 50

# 显存不足：减小批次
python conf_check.py "file.xlsx" "Sheet1" "text" --batch-size 15
```

### 3. 知识库集成

支持引用知识库进行检查：

```
@剧情对白知识库 使用 SKILL 检查 F:\task.xlsx 的 Sheet1 sheet，检查 text 列
```

AI 会自动从知识库中获取：敏感词列表、文案规范、游戏角色名称等。

### 4. 批量检查

```bash
# Linux/macOS
for file in *.xlsx; do
    python conf_check.py "$file" "Sheet1" "text"
done

# Windows PowerShell
Get-ChildItem *.xlsx | ForEach-Object {
    python conf_check.py $_.FullName "Sheet1" "text"
}
```

---

## 🛠️ 故障排除

### 问题1：模型不存在

```
❌ 错误: 模型 'xxx' 不存在！
```

**解决方案**：
```bash
ollama list                      # 查看可用模型
ollama pull qwen3:14b-q4_K_M    # 下载模型
```

### 问题2：JSON 解析失败

```
⚠️ JSON解析失败
```

**原因**：模型输出被截断或格式错误

**解决方案**：
1. 减小 `BATCH_SIZE`（如 15-20）
2. 检查 `llm_debug_*.txt` 文件
3. 增加 `num_predict` 参数

### 问题3：文件被占用

```
❌ 文件被占用
```

**解决方案**：
1. 关闭 Excel 中打开的报告文件
2. 脚本会自动生成带时间戳的新文件

### 问题4：列名找不到

```
❌ 错误: 没找到列名 'xxx'
```

**解决方案**：
1. 查看脚本输出的所有列名
2. 使用正确的列名
3. 脚本支持模糊匹配

---

## 📈 性能优化

### 批次大小优化

| 批次大小 | 特点 | 推荐场景 |
|----------|------|----------|
| 10-20 | 准确度高，速度慢 | 显存不足、精细检查 |
| 30-50 | 平衡推荐 | 日常使用 |
| 50-100 | 速度快，可能幻觉 | 显存充足、快速检查 |

### 数据量建议

| 数据量 | 批次大小 | 预计时间 |
|--------|----------|----------|
| <100 行 | 50 | <2 分钟 |
| 100-1000 行 | 30 | 5-15 分钟 |
| >1000 行 | 20 | 30+ 分钟 |

---

## 📚 使用场景

### 场景1：日常配置检查

```bash
python conf_check.py "F:\trunk_conf\task.xlsx" "TASK_CONF" "text"
```

### 场景2：批量导出检查

```bash
python conf_check.py "F:\导出全部对话.xlsx" "全部对话" "对白内容"
```

### 场景3：CI/CD 集成

```yaml
# .github/workflows/config-check.yml
- name: Check Config Text
  run: |
    python conf_check.py "${{ github.workspace }}/config.xlsx" "Sheet1" "text"
```

---

## 🎓 最佳实践

### 检查前准备

- ✅ 确保 Ollama 服务运行
- ✅ 确认模型已下载
- ✅ 备份原始配置文件
- ✅ 关闭 Excel 中打开的文件

### 检查中监控

- 📊 观察进度条
- 🔍 注意警告信息
- 💾 检查调试文件

### 检查后处理

- 📝 仔细审阅报告
- ✏️ 人工复核 AI 建议
- 🔄 修改后重新检查
- 📦 归档检查报告

---

## � 更新日志

### v2.3 (2025-12-19)
- 🏥 新增模型健康度检查和自动启动功能
- ⚡ GPU 加速优化（num_gpu: 99）
- 🛡️ 增强 JSON 解析容错处理
- 📊 改进报告格式（添加对白 ID）
- � 支持多行表头 Excel

### v2.0 (2025-12-17)
- ✨ 转换为 Claude SKILL 标准格式
- 🎯 优化检查规范和提示词
- 📊 增强报告格式
- 🛡️ 完善容错处理
- 📚 添加详细文档

### v1.0 (2025-12-16)
- 🎉 初始版本
- 🤖 基于 Ollama 的 AI 检查
- 📦 批量处理支持
- 📝 Excel 报告生成

---

## 📞 技术支持

如遇到问题：

1. 📖 查看 [docs/FAQ.md](docs/FAQ.md) 常见问题
2. 📄 检查 `llm_debug_*.txt` 调试文件
3. 🐛 提交 [Issue](https://github.com/wendellhua/game-config-text-checker/issues)
